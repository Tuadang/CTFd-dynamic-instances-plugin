{% extends "challenge.html" %}

{% block description %}
<div class="challenge-desc mb-4">
  {{ challenge.description | safe }}
</div>
{% endblock %}

{% block input %}
<div class="row g-4">

  <!-- LEFT: Instance Control -->
  <div class="col-md-6">

    <h6 class="text-uppercase fw-bold mb-3">
      <i class="fas fa-server me-2"></i> Instance Control
      <span id="instance-status-badge" class="ms-2">
        <span class="badge bg-danger">Offline</span>
      </span>
    </h6>

    <div class="d-flex gap-2 mb-3">
      <button id="start-instance" class="btn btn-success flex-grow-1">
        <i class="fas fa-play me-1"></i> Start
      </button>

      <button id="status-instance" class="btn btn-outline-info">
        <i class="fas fa-sync-alt"></i>
      </button>

      <button id="stop-instance" class="btn btn-outline-danger">
        <i class="fas fa-stop me-1"></i> Stop
      </button>
    </div>

    <label class="form-label small text-muted fw-bold text-uppercase">
      Connection Info
    </label>

    <div class="input-group mb-2">
      <input
        type="text"
        id="instance-connection"
        class="form-control font-monospace"
        value="Instance not started..."
        readonly
      >
      <button class="btn btn-outline-secondary" type="button" onclick="copyConnection()">
        <i class="fas fa-copy"></i>
      </button>
    </div>

    <div id="instance-timer" class="small text-muted"></div>
  </div>

  <!-- RIGHT: Flag Submission (CTFd native) -->
  <div class="col-md-6">

    <!-- REQUIRED by CTFd -->
    <input
      type="hidden"
      id="challenge-id"
      class="challenge-id"
      value="{{ challenge.id }}"
    >

    <label class="form-label fw-bold">Flag</label>
    <input
      id="challenge-input"
      class="challenge-input form-control"
      type="text"
      name="submission"
      placeholder="CTF{...}"
      autocomplete="off"
    >

    <button
      id="challenge-submit"
      class="challenge-submit btn btn-outline-secondary w-100 mt-3"
      type="submit"
      @click.debounce.500ms="submitChallenge()"
    >
      Submit
    </button>

  </div>
</div>

<script>
function copyConnection() {
  const input = document.getElementById("instance-connection");
  if (!input.value.includes("not started")) {
    navigator.clipboard.writeText(input.value);
  }
}
</script>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/k8s_view.js') }}"></script>
{% endblock %}
