{% extends "challenge.html" %}

{% block description %}
<div class="challenge-desc mb-4">
  {{ challenge.description | safe }}
</div>
{% endblock %}

{% block input %}
  <!-- Instance Control (CTFd-style section) -->
    <h5 class="text-uppercase fw-bold mb-3">
      <i class="fas fa-server me-2"></i>Instance Control
      <span id="instance-status-badge" class="ms-2">
        <span class="badge bg-danger">Offline</span>
      </span>
    </h5>

    <div class="d-flex gap-2 mb-3">
      <button id="start-instance" class="btn btn-success flex-grow-1">
        <i class="fas fa-play me-1"></i> Start
      </button>

      <button id="status-instance" class="btn btn-outline-info">
        <i class="fas fa-sync-alt"></i>
      </button>

      <button id="stop-instance" class="btn btn-outline-danger">
        <i class="fas fa-stop me-1"></i> Stop
      </button>
    </div>

    <label class="form-label small text-muted text-uppercase fw-bold">Connection Info</label>

    <div class="input-group mb-1">
      <input 
        type="text" 
        id="instance-connection" 
        class="form-control font-monospace" 
        value="Instance not started..." 
        readonly
      >
      <button class="btn btn-outline-secondary" type="button" onclick="copyConnection()">
        <i class="fas fa-copy"></i>
      </button>
    </div>

    <div id="instance-timer" class="small text-muted"></div>

  <!-- Submit Flag (CTFd native) -->
  <!-- <div class="mt-4">
    <h5 class="text-uppercase fw-bold mb-3">Submit Flag</h5>

    <form id="flag-submit-form">
      <input 
        id="challenge-input"
        class="challenge-input form-control form-control-lg mb-3"
        type="text"
        name="submission"
        placeholder="CTF{flag_here}"
        required
      >

      <button id="challenge-submit" class="challenge-submit btn btn-primary w-100 btn-lg" type="submit">
        Submit
      </button>
    </form>
  </div> -->

<script>
function copyConnection() {
  const input = document.getElementById("instance-connection");
  if (!input.value.includes("not started")) {
    input.select();
    navigator.clipboard.writeText(input.value);
    alert("Connection string copied!");
  }
}
</script>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/k8s_view.js') }}"></script>
{% endblock %}
